export class BaseNode {
    constructor(id, parentId) {
        this.id = id;
        this.parentId = parentId;
    }
}
class TreeNode extends BaseNode {
    constructor(entity, nameResolver = ent => ent.displayName || ent.name) {
        super(entity.id, entity.parentId);
        this.entity = entity;
        this.nameResolver = nameResolver;
        this.icon = null;
        this.children = [];
        this.isLeaf = true;
        this.checked = false;
        this.selected = false;
        this.expanded = false;
        this.selectable = true;
        this.disabled = false;
        this.disableCheckbox = false;
        this.key = entity.id;
        this.title = nameResolver(entity);
    }
}
export class TreeAdapter {
    constructor(list = []) {
        this.list = list;
        this.tree = createTreeFromList(this.list);
    }
    getList() {
        return this.list;
    }
    getTree() {
        return this.tree;
    }
    handleDrop({ key, parentNode }) {
        const index = this.list.findIndex(({ id }) => id === key);
        this.list[index].parentId = parentNode ? parentNode.key : null;
        this.tree = createTreeFromList(this.list);
    }
    handleRemove({ key }) {
        this.updateTreeFromList(this.list.filter(item => item.id !== key));
    }
    handleUpdate({ key, children }) {
        /**
         * When we need to update a node with new children, first we need to remove any descendant nodes.
         * If we remove immediate children and create a new tree, any other descendant nodes will be removed
         * and we won't need to recursively remove sub children.
         * Then, you simply add back the new children and create a new tree.
         */
        const listWithDescendantNodesRemoved = this.updateTreeFromList(this.list.filter(item => item.parentId !== key));
        this.updateTreeFromList(listWithDescendantNodesRemoved.concat(children));
    }
    updateTreeFromList(list) {
        this.tree = createTreeFromList(list);
        this.list = createListFromTree(this.tree);
        return this.list;
    }
}
// UTILITY FUNCTIONS
function createTreeFromList(list) {
    const map = createMapFromList(list);
    const tree = [];
    list.forEach(row => {
        const parentId = row.parentId;
        const node = map.get(row.id);
        if (parentId) {
            const parent = map.get(parentId);
            if (!parent)
                return;
            parent.children.push(node);
            parent.isLeaf = false;
        }
        else {
            tree.push(node);
        }
    });
    return tree;
}
function createListFromTree(tree, list = []) {
    tree.forEach(node => {
        list.push({ ...node.entity, parentId: node.parentId });
        if (node.children)
            createListFromTree(node.children, list);
    });
    return list;
}
function createMapFromList(list, map = new Map()) {
    list.forEach(row => map.set(row.id, new TreeNode(row)));
    return map;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibnotdHJlZS1hZGFwdGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcGFja2FnZXMvY29tcG9uZW50cy90cmVlL3NyYy9saWIvdXRpbHMvbnotdHJlZS1hZGFwdGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE1BQU0sT0FBZ0IsUUFBUTtJQUk1QixZQUFtQixFQUFVLEVBQVMsUUFBdUI7UUFBMUMsT0FBRSxHQUFGLEVBQUUsQ0FBUTtRQUFTLGFBQVEsR0FBUixRQUFRLENBQWU7SUFBRyxDQUFDO0NBQ2xFO0FBRUQsTUFBTSxRQUE2QixTQUFRLFFBQVE7SUFjakQsWUFBbUIsTUFBUyxFQUFVLGVBQWUsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsV0FBVyxJQUFJLEdBQUcsQ0FBQyxJQUFJO1FBQ3JGLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQztRQURqQixXQUFNLEdBQU4sTUFBTSxDQUFHO1FBQVUsaUJBQVksR0FBWixZQUFZLENBQXFDO1FBWHZGLFNBQUksR0FBa0IsSUFBSSxDQUFDO1FBQzNCLGFBQVEsR0FBa0IsRUFBRSxDQUFDO1FBQzdCLFdBQU0sR0FBRyxJQUFJLENBQUM7UUFDZCxZQUFPLEdBQUcsS0FBSyxDQUFDO1FBQ2hCLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFDakIsYUFBUSxHQUFHLEtBQUssQ0FBQztRQUNqQixlQUFVLEdBQUcsSUFBSSxDQUFDO1FBQ2xCLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFDakIsb0JBQWUsR0FBRyxLQUFLLENBQUM7UUFLdEIsSUFBSSxDQUFDLEdBQUcsR0FBRyxNQUFNLENBQUMsRUFBRSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxLQUFLLEdBQUcsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3BDLENBQUM7Q0FDRjtBQUVELE1BQU0sT0FBTyxXQUFXO0lBR3RCLFlBQW9CLE9BQVksRUFBRTtRQUFkLFNBQUksR0FBSixJQUFJLENBQVU7UUFDaEMsSUFBSSxDQUFDLElBQUksR0FBRyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDNUMsQ0FBQztJQUVELE9BQU87UUFDTCxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUM7SUFDbkIsQ0FBQztJQUVELE9BQU87UUFDTCxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUM7SUFDbkIsQ0FBQztJQUVELFVBQVUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxVQUFVLEVBQWU7UUFDekMsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEtBQUssR0FBRyxDQUFDLENBQUM7UUFDMUQsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxRQUFRLEdBQUcsVUFBVSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFDL0QsSUFBSSxDQUFDLElBQUksR0FBRyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDNUMsQ0FBQztJQUVELFlBQVksQ0FBQyxFQUFFLEdBQUcsRUFBZTtRQUMvQixJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDckUsQ0FBQztJQUVELFlBQVksQ0FBQyxFQUFFLEdBQUcsRUFBRSxRQUFRLEVBQWtDO1FBQzVEOzs7OztXQUtHO1FBQ0gsTUFBTSw4QkFBOEIsR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQzVELElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsS0FBSyxHQUFHLENBQUMsQ0FDaEQsQ0FBQztRQUNGLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyw4QkFBOEIsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztJQUMzRSxDQUFDO0lBRUQsa0JBQWtCLENBQUMsSUFBUztRQUMxQixJQUFJLENBQUMsSUFBSSxHQUFHLGtCQUFrQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3JDLElBQUksQ0FBQyxJQUFJLEdBQUcsa0JBQWtCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzFDLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQztJQUNuQixDQUFDO0NBQ0Y7QUFFRCxvQkFBb0I7QUFFcEIsU0FBUyxrQkFBa0IsQ0FBcUIsSUFBUztJQUN2RCxNQUFNLEdBQUcsR0FBRyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNwQyxNQUFNLElBQUksR0FBa0IsRUFBRSxDQUFDO0lBRS9CLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUU7UUFDakIsTUFBTSxRQUFRLEdBQUcsR0FBRyxDQUFDLFFBQVEsQ0FBQztRQUM5QixNQUFNLElBQUksR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUM3QixJQUFJLFFBQVEsRUFBRTtZQUNaLE1BQU0sTUFBTSxHQUFHLEdBQUcsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDakMsSUFBSSxDQUFDLE1BQU07Z0JBQUUsT0FBTztZQUNwQixNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUMzQixNQUFNLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQztTQUN2QjthQUFNO1lBQ0wsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNqQjtJQUNILENBQUMsQ0FBQyxDQUFDO0lBRUgsT0FBTyxJQUFJLENBQUM7QUFDZCxDQUFDO0FBRUQsU0FBUyxrQkFBa0IsQ0FBcUIsSUFBbUIsRUFBRSxPQUFZLEVBQUU7SUFDakYsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRTtRQUNsQixJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLFFBQVEsRUFBRSxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQztRQUN2RCxJQUFJLElBQUksQ0FBQyxRQUFRO1lBQUUsa0JBQWtCLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUM3RCxDQUFDLENBQUMsQ0FBQztJQUVILE9BQU8sSUFBSSxDQUFDO0FBQ2QsQ0FBQztBQUVELFNBQVMsaUJBQWlCLENBQ3hCLElBQVMsRUFDVCxNQUFNLElBQUksR0FBRyxFQUF1QjtJQUVwQyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLElBQUksUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUV4RCxPQUFPLEdBQUcsQ0FBQztBQUNiLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgYWJzdHJhY3QgY2xhc3MgQmFzZU5vZGUge1xyXG4gIG5hbWU/OiBzdHJpbmc7XHJcbiAgZGlzcGxheU5hbWU/OiBzdHJpbmc7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBpZDogc3RyaW5nLCBwdWJsaWMgcGFyZW50SWQ6IHN0cmluZyB8IG51bGwpIHt9XHJcbn1cclxuXHJcbmNsYXNzIFRyZWVOb2RlPFQgZXh0ZW5kcyBCYXNlTm9kZT4gZXh0ZW5kcyBCYXNlTm9kZSB7XHJcbiAgdGl0bGU6IHN0cmluZyB8IHVuZGVmaW5lZDtcclxuICBrZXk6IHN0cmluZztcclxuICBpY29uOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcclxuICBjaGlsZHJlbjogVHJlZU5vZGU8VD5bXSA9IFtdO1xyXG4gIGlzTGVhZiA9IHRydWU7XHJcbiAgY2hlY2tlZCA9IGZhbHNlO1xyXG4gIHNlbGVjdGVkID0gZmFsc2U7XHJcbiAgZXhwYW5kZWQgPSBmYWxzZTtcclxuICBzZWxlY3RhYmxlID0gdHJ1ZTtcclxuICBkaXNhYmxlZCA9IGZhbHNlO1xyXG4gIGRpc2FibGVDaGVja2JveCA9IGZhbHNlO1xyXG4gIHBhcmVudE5vZGU/OiBUcmVlTm9kZTxUPiB8IG51bGw7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBlbnRpdHk6IFQsIHByaXZhdGUgbmFtZVJlc29sdmVyID0gZW50ID0+IGVudC5kaXNwbGF5TmFtZSB8fCBlbnQubmFtZSkge1xyXG4gICAgc3VwZXIoZW50aXR5LmlkLCBlbnRpdHkucGFyZW50SWQpO1xyXG4gICAgdGhpcy5rZXkgPSBlbnRpdHkuaWQ7XHJcbiAgICB0aGlzLnRpdGxlID0gbmFtZVJlc29sdmVyKGVudGl0eSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgVHJlZUFkYXB0ZXI8VCBleHRlbmRzIEJhc2VOb2RlID0gQmFzZU5vZGU+IHtcclxuICBwcml2YXRlIHRyZWU6IFRyZWVOb2RlPFQ+W107XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgbGlzdDogVFtdID0gW10pIHtcclxuICAgIHRoaXMudHJlZSA9IGNyZWF0ZVRyZWVGcm9tTGlzdCh0aGlzLmxpc3QpO1xyXG4gIH1cclxuXHJcbiAgZ2V0TGlzdCgpIHtcclxuICAgIHJldHVybiB0aGlzLmxpc3Q7XHJcbiAgfVxyXG5cclxuICBnZXRUcmVlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMudHJlZTtcclxuICB9XHJcblxyXG4gIGhhbmRsZURyb3AoeyBrZXksIHBhcmVudE5vZGUgfTogVHJlZU5vZGU8VD4pIHtcclxuICAgIGNvbnN0IGluZGV4ID0gdGhpcy5saXN0LmZpbmRJbmRleCgoeyBpZCB9KSA9PiBpZCA9PT0ga2V5KTtcclxuICAgIHRoaXMubGlzdFtpbmRleF0ucGFyZW50SWQgPSBwYXJlbnROb2RlID8gcGFyZW50Tm9kZS5rZXkgOiBudWxsO1xyXG4gICAgdGhpcy50cmVlID0gY3JlYXRlVHJlZUZyb21MaXN0KHRoaXMubGlzdCk7XHJcbiAgfVxyXG5cclxuICBoYW5kbGVSZW1vdmUoeyBrZXkgfTogVHJlZU5vZGU8VD4pIHtcclxuICAgIHRoaXMudXBkYXRlVHJlZUZyb21MaXN0KHRoaXMubGlzdC5maWx0ZXIoaXRlbSA9PiBpdGVtLmlkICE9PSBrZXkpKTtcclxuICB9XHJcblxyXG4gIGhhbmRsZVVwZGF0ZSh7IGtleSwgY2hpbGRyZW4gfTogeyBrZXk6IHN0cmluZzsgY2hpbGRyZW46IFRbXSB9KSB7XHJcbiAgICAvKipcclxuICAgICAqIFdoZW4gd2UgbmVlZCB0byB1cGRhdGUgYSBub2RlIHdpdGggbmV3IGNoaWxkcmVuLCBmaXJzdCB3ZSBuZWVkIHRvIHJlbW92ZSBhbnkgZGVzY2VuZGFudCBub2Rlcy5cclxuICAgICAqIElmIHdlIHJlbW92ZSBpbW1lZGlhdGUgY2hpbGRyZW4gYW5kIGNyZWF0ZSBhIG5ldyB0cmVlLCBhbnkgb3RoZXIgZGVzY2VuZGFudCBub2RlcyB3aWxsIGJlIHJlbW92ZWRcclxuICAgICAqIGFuZCB3ZSB3b24ndCBuZWVkIHRvIHJlY3Vyc2l2ZWx5IHJlbW92ZSBzdWIgY2hpbGRyZW4uXHJcbiAgICAgKiBUaGVuLCB5b3Ugc2ltcGx5IGFkZCBiYWNrIHRoZSBuZXcgY2hpbGRyZW4gYW5kIGNyZWF0ZSBhIG5ldyB0cmVlLlxyXG4gICAgICovXHJcbiAgICBjb25zdCBsaXN0V2l0aERlc2NlbmRhbnROb2Rlc1JlbW92ZWQgPSB0aGlzLnVwZGF0ZVRyZWVGcm9tTGlzdChcclxuICAgICAgdGhpcy5saXN0LmZpbHRlcihpdGVtID0+IGl0ZW0ucGFyZW50SWQgIT09IGtleSksXHJcbiAgICApO1xyXG4gICAgdGhpcy51cGRhdGVUcmVlRnJvbUxpc3QobGlzdFdpdGhEZXNjZW5kYW50Tm9kZXNSZW1vdmVkLmNvbmNhdChjaGlsZHJlbikpO1xyXG4gIH1cclxuXHJcbiAgdXBkYXRlVHJlZUZyb21MaXN0KGxpc3Q6IFRbXSkge1xyXG4gICAgdGhpcy50cmVlID0gY3JlYXRlVHJlZUZyb21MaXN0KGxpc3QpO1xyXG4gICAgdGhpcy5saXN0ID0gY3JlYXRlTGlzdEZyb21UcmVlKHRoaXMudHJlZSk7XHJcbiAgICByZXR1cm4gdGhpcy5saXN0O1xyXG4gIH1cclxufVxyXG5cclxuLy8gVVRJTElUWSBGVU5DVElPTlNcclxuXHJcbmZ1bmN0aW9uIGNyZWF0ZVRyZWVGcm9tTGlzdDxUIGV4dGVuZHMgQmFzZU5vZGU+KGxpc3Q6IFRbXSk6IFRyZWVOb2RlPFQ+W10ge1xyXG4gIGNvbnN0IG1hcCA9IGNyZWF0ZU1hcEZyb21MaXN0KGxpc3QpO1xyXG4gIGNvbnN0IHRyZWU6IFRyZWVOb2RlPFQ+W10gPSBbXTtcclxuXHJcbiAgbGlzdC5mb3JFYWNoKHJvdyA9PiB7XHJcbiAgICBjb25zdCBwYXJlbnRJZCA9IHJvdy5wYXJlbnRJZDtcclxuICAgIGNvbnN0IG5vZGUgPSBtYXAuZ2V0KHJvdy5pZCk7XHJcbiAgICBpZiAocGFyZW50SWQpIHtcclxuICAgICAgY29uc3QgcGFyZW50ID0gbWFwLmdldChwYXJlbnRJZCk7XHJcbiAgICAgIGlmICghcGFyZW50KSByZXR1cm47XHJcbiAgICAgIHBhcmVudC5jaGlsZHJlbi5wdXNoKG5vZGUpO1xyXG4gICAgICBwYXJlbnQuaXNMZWFmID0gZmFsc2U7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0cmVlLnB1c2gobm9kZSk7XHJcbiAgICB9XHJcbiAgfSk7XHJcblxyXG4gIHJldHVybiB0cmVlO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjcmVhdGVMaXN0RnJvbVRyZWU8VCBleHRlbmRzIEJhc2VOb2RlPih0cmVlOiBUcmVlTm9kZTxUPltdLCBsaXN0OiBUW10gPSBbXSk6IFRbXSB7XHJcbiAgdHJlZS5mb3JFYWNoKG5vZGUgPT4ge1xyXG4gICAgbGlzdC5wdXNoKHsgLi4ubm9kZS5lbnRpdHksIHBhcmVudElkOiBub2RlLnBhcmVudElkIH0pO1xyXG4gICAgaWYgKG5vZGUuY2hpbGRyZW4pIGNyZWF0ZUxpc3RGcm9tVHJlZShub2RlLmNoaWxkcmVuLCBsaXN0KTtcclxuICB9KTtcclxuXHJcbiAgcmV0dXJuIGxpc3Q7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNyZWF0ZU1hcEZyb21MaXN0PFQgZXh0ZW5kcyBCYXNlTm9kZT4oXHJcbiAgbGlzdDogVFtdLFxyXG4gIG1hcCA9IG5ldyBNYXA8c3RyaW5nLCBUcmVlTm9kZTxUPj4oKSxcclxuKTogTWFwPHN0cmluZywgVHJlZU5vZGU8VD4+IHtcclxuICBsaXN0LmZvckVhY2gocm93ID0+IG1hcC5zZXQocm93LmlkLCBuZXcgVHJlZU5vZGUocm93KSkpO1xyXG5cclxuICByZXR1cm4gbWFwO1xyXG59XHJcbiJdfQ==